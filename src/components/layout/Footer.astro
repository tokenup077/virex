---
/**
 * Footer - Site-wide footer with navigation and social links
 *
 * @description
 * A comprehensive footer with 5-column navigation layout:
 * Brand, Product, Solutions, Resources, Company.
 * Navigation items are automatically filtered based on feature flags.
 *
 * @example
 * ```astro
 * <Footer />
 * ```
 */
import { siteConfig } from '@/config';
import { Icon } from 'astro-icon/components';
import type { FeatureFlags, NavigationItem } from '@/lib/types';

const { features, social, contact, navigation } = siteConfig;
const { footer } = navigation;
const currentYear = new Date().getFullYear();

// Helper to filter items by feature flag
const filterByFeature = (items: NavigationItem[]) =>
  items.filter((item) => !item.feature || features[item.feature as keyof FeatureFlags]);

// Filter all navigation sections
const productLinks = filterByFeature(footer.product);
const solutionsLinks = filterByFeature(footer.solutions);
const resourcesLinks = filterByFeature(footer.resources);
const companyLinks = filterByFeature(footer.company);
const legalLinks = filterByFeature(footer.legal);

function gtmForHref(href: string) {
  if (href === '/contact') return 'reserve';
  if (href === '/service' || href === '/price') return 'menu';
  if (href === '/access') return 'access';
  return undefined;
}
---

<footer class="bg-surface border-t border-background">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Links Grid -->
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-8 lg:gap-12">
      <!-- Brand Column -->
      <div class="col-span-2 sm:col-span-3 lg:col-span-2 mb-4 lg:mb-0">
        <a href="/" class="inline-flex items-center gap-2 font-semibold text-lg text-text">
          {
            siteConfig.logo ? (
              <img src={siteConfig.logo} alt={siteConfig.name} class="h-8 w-auto" />
            ) : (
              siteConfig.name
            )
          }
        </a>
        <p class="mt-3 text-sm text-text-muted max-w-xs">
          {siteConfig.description}
        </p>
        <!-- Contact Info -->
        <div class="mt-4 space-y-1 text-sm text-text-muted">
          {
            contact.email && (
              <a href={`mailto:${contact.email}`} class="block hover:text-text transition-colors">
                {contact.email}
              </a>
            )
          }
          {
            contact.address && (
              <p>
                {contact.address.city}, {contact.address.state}, {contact.address.country}
              </p>
            )
          }
        </div>
        <!-- Social Links -->
        <div class="flex items-center gap-4 mt-4">
          {
            social.twitter && (
              <a
                href={social.twitter}
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Twitter"
                class="text-text-muted hover:text-text transition-colors"
              >
                <Icon name="lucide:twitter" class="w-5 h-5" />
              </a>
            )
          }
          {
            social.github && (
              <a
                href={social.github}
                target="_blank"
                rel="noopener noreferrer"
                aria-label="GitHub"
                class="text-text-muted hover:text-text transition-colors"
              >
                <Icon name="lucide:github" class="w-5 h-5" />
              </a>
            )
          }
          {
            social.discord && (
              <a
                href={social.discord}
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Discord"
                class="text-text-muted hover:text-text transition-colors"
              >
                <Icon name="simple-icons:discord" class="w-5 h-5" />
              </a>
            )
          }
        </div>
      </div>

      <!-- Product Column -->
      {
        productLinks.length > 0 && (
          <div>
            <h3 class="font-semibold text-sm text-text mb-4">Product</h3>
            <ul class="space-y-3">
              {productLinks.map((link) => (
                <li>
                  <a
                    href={link.href}
                    data-gtm={gtmForHref(link.href)}
                    class="text-sm text-text-muted hover:text-text transition-colors"
                  >
                    {link.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        )
      }

      <!-- Solutions Column -->
      {
        solutionsLinks.length > 0 && (
          <div>
            <h3 class="font-semibold text-sm text-text mb-4">Solutions</h3>
            <ul class="space-y-3">
              {solutionsLinks.map((link) => (
                <li>
                  <a
                    href={link.href}
                    data-gtm={gtmForHref(link.href)}
                    class="text-sm text-text-muted hover:text-text transition-colors"
                  >
                    {link.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        )
      }

      <!-- Resources Column -->
      {
        resourcesLinks.length > 0 && (
          <div>
            <h3 class="font-semibold text-sm text-text mb-4">Resources</h3>
            <ul class="space-y-3">
              {resourcesLinks.map((link) => (
                <li>
                  <a
                    href={link.href}
                    data-gtm={gtmForHref(link.href)}
                    class="text-sm text-text-muted hover:text-text transition-colors"
                  >
                    {link.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        )
      }

      <!-- Company Column -->
      {
        companyLinks.length > 0 && (
          <div>
            <h3 class="font-semibold text-sm text-text mb-4">Company</h3>
            <ul class="space-y-3">
              {companyLinks.map((link) => (
                <li>
                  <a
                    href={link.href}
                    data-gtm={gtmForHref(link.href)}
                    class="text-sm text-text-muted hover:text-text transition-colors"
                  >
                    {link.label}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        )
      }
    </div>

    <!-- Bottom Bar -->
    <div class="mt-12 pt-8 border-t border-background">
      <div
        class="flex flex-col items-center md:flex-row md:justify-between gap-4 text-center md:text-left"
      >
        <!-- Copyright -->
        <p class="text-sm text-text-muted">
          &copy; {currentYear}
          {siteConfig.name}. All rights reserved.
        </p>
        <!-- Legal Links -->
        <div class="flex items-center gap-6">
          {
            legalLinks.map((link) => (
              <a href={link.href} data-gtm={gtmForHref(link.href)} class="text-sm text-text-muted hover:text-text transition-colors">
                {link.label}
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</footer>
