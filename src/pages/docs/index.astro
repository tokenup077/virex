---
/**
 * Documentation Landing Page
 *
 * @description
 * A landing page for documentation that displays all available docs
 * organized by section with descriptions and quick links.
 */
import { getCollection } from 'astro:content';
import MarketingLayout from '../../layouts/MarketingLayout.astro';
import { Icon } from 'astro-icon/components';
import { siteConfig } from '@/config';

// Get all non-draft docs
const allDocs = await getCollection('docs', ({ data }) => !data.draft);

// Group docs by section and sort by order
interface DocItem {
  title: string;
  description: string;
  slug: string;
  order: number;
}

interface DocsSection {
  section: string;
  items: DocItem[];
}

const sectionMap = new Map<string, DocItem[]>();

for (const doc of allDocs) {
  const sectionName = doc.data.section;
  if (!sectionMap.has(sectionName)) {
    sectionMap.set(sectionName, []);
  }
  sectionMap.get(sectionName)!.push({
    title: doc.data.title,
    description: doc.data.description,
    slug: doc.slug,
    order: doc.data.order,
  });
}

// Sort items within each section by order
const docsSections: DocsSection[] = [];
for (const [sectionName, items] of sectionMap) {
  items.sort((a, b) => a.order - b.order);
  docsSections.push({ section: sectionName, items });
}

// Sort sections by the minimum order of their items
docsSections.sort((a, b) => {
  const aMinOrder = Math.min(...a.items.map((i) => i.order));
  const bMinOrder = Math.min(...b.items.map((i) => i.order));
  return aMinOrder - bMinOrder;
});

// Get the first doc for "Get Started" button
const firstDoc = allDocs.sort((a, b) => a.data.order - b.data.order)[0];

// Section icons mapping
const sectionIcons: Record<string, string> = {
  'Getting Started': 'lucide:rocket',
  'Configuration': 'lucide:settings',
  'Customization': 'lucide:palette',
  'Guides': 'lucide:book-open',
  'Reference': 'lucide:file-text',
  'FAQ': 'lucide:help-circle',
};

function getSectionIcon(section: string): string {
  return sectionIcons[section] || 'lucide:file-text';
}
---

<MarketingLayout
  title={`Documentation - ${siteConfig.name}`}
  description={`Learn how to use ${siteConfig.name}. Guides, tutorials, and reference documentation to help you get started.`}
>
  <!-- Hero Section -->
  <section class="py-section bg-surface">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="text-4xl sm:text-5xl font-bold text-text">Documentation</h1>
        <p class="mt-6 text-lg text-text-muted">
          Everything you need to know about {siteConfig.name}. From getting
          started to advanced configuration.
        </p>
        <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
          {
            firstDoc && (
              <a
                href={`/docs/${firstDoc.slug}`}
                class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-md bg-primary text-white font-medium hover:bg-primary-dark transition-colors"
              >
                <Icon name="lucide:book-open" class="w-5 h-5" />
                Get Started
              </a>
            )
          }
          <a
            href="#sections"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-md border border-border bg-background text-text font-medium hover:bg-surface transition-colors"
          >
            <Icon name="lucide:list" class="w-5 h-5" />
            Browse All
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Quick Links -->
  <section class="py-12 border-b border-border">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <a
          href="/docs/installation"
          class="flex items-center gap-3 p-4 rounded-lg bg-surface hover:bg-surface/80 transition-colors group"
        >
          <div
            class="p-2 rounded-md bg-primary/10 text-primary group-hover:bg-primary group-hover:text-white transition-colors"
          >
            <Icon name="lucide:download" class="w-5 h-5" />
          </div>
          <span class="font-medium text-text">Installation</span>
        </a>
        <a
          href="/docs/configuration"
          class="flex items-center gap-3 p-4 rounded-lg bg-surface hover:bg-surface/80 transition-colors group"
        >
          <div
            class="p-2 rounded-md bg-primary/10 text-primary group-hover:bg-primary group-hover:text-white transition-colors"
          >
            <Icon name="lucide:settings" class="w-5 h-5" />
          </div>
          <span class="font-medium text-text">Configuration</span>
        </a>
        <a
          href="/docs/customization"
          class="flex items-center gap-3 p-4 rounded-lg bg-surface hover:bg-surface/80 transition-colors group"
        >
          <div
            class="p-2 rounded-md bg-primary/10 text-primary group-hover:bg-primary group-hover:text-white transition-colors"
          >
            <Icon name="lucide:palette" class="w-5 h-5" />
          </div>
          <span class="font-medium text-text">Customization</span>
        </a>
        <a
          href="/docs/faq"
          class="flex items-center gap-3 p-4 rounded-lg bg-surface hover:bg-surface/80 transition-colors group"
        >
          <div
            class="p-2 rounded-md bg-primary/10 text-primary group-hover:bg-primary group-hover:text-white transition-colors"
          >
            <Icon name="lucide:help-circle" class="w-5 h-5" />
          </div>
          <span class="font-medium text-text">FAQ</span>
        </a>
      </div>
    </div>
  </section>

  <!-- Documentation Sections -->
  <section id="sections" class="py-section">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="space-y-12">
        {
          docsSections.map((section) => (
            <div>
              <div class="flex items-center gap-3 mb-6">
                <div class="p-2 rounded-md bg-primary/10 text-primary">
                  <Icon name={getSectionIcon(section.section)} class="w-6 h-6" />
                </div>
                <h2 class="text-2xl font-bold text-text">{section.section}</h2>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {section.items.map((doc) => (
                  <a
                    href={`/docs/${doc.slug}`}
                    class="block p-6 rounded-lg border border-border bg-background hover:border-primary hover:shadow-md transition-all group"
                  >
                    <h3 class="font-semibold text-text group-hover:text-primary transition-colors">
                      {doc.title}
                    </h3>
                    <p class="mt-2 text-sm text-text-muted line-clamp-2">
                      {doc.description}
                    </p>
                    <div class="mt-4 flex items-center gap-1 text-sm text-primary font-medium">
                      Read more
                      <Icon
                        name="lucide:arrow-right"
                        class="w-4 h-4 group-hover:translate-x-1 transition-transform"
                      />
                    </div>
                  </a>
                ))}
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Help Section -->
  <section class="py-section bg-surface">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-2xl font-bold text-text">Need more help?</h2>
        <p class="mt-4 text-text-muted">
          Can't find what you're looking for? We're here to help.
        </p>
        <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/contact"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-md border border-border bg-background text-text font-medium hover:bg-background/80 transition-colors"
          >
            <Icon name="lucide:mail" class="w-5 h-5" />
            Contact Support
          </a>
          <a
            href="/faq"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-md border border-border bg-background text-text font-medium hover:bg-background/80 transition-colors"
          >
            <Icon name="lucide:help-circle" class="w-5 h-5" />
            View FAQ
          </a>
        </div>
      </div>
    </div>
  </section>
</MarketingLayout>
